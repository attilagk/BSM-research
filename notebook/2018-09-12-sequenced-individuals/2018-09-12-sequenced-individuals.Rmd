---
layout: default
title: Summary on CMC and Benchmark
featimg: summary-1.png
---

Which individuals have been sequenced?

For the answer see the `src/sequenced-individuals.sh` as well as the `data/dnalib/get-cmc-individuals` scripts.

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(lme4)
library(lattice)
library(latticeExtra)
opts_chunk$set(dpi = 144)
opts_chunk$set(out.width = "600px")
opts_chunk$set(dev = c("png", "pdf"))
lattice.options(default.args = list(as.table = TRUE))
lattice.options(default.theme = "standard.theme")
source("2018-09-12-sequenced-individuals.R")
```

```{r engine="bash"}
indivs=$HOME/projects/bsm/results/2018-09-12-sequenced-individuals/sequenced-individuals
cat $indivs
```

Thus the number of sequenced individuals is

```{r engine="bash", echo=FALSE}
indivs=$HOME/projects/bsm/results/2018-09-12-sequenced-individuals/sequenced-individuals
wc -w $indivs
```

Download and import `CMC_Human_clinical_metadata.csv` for later use.

```{r engine="bash", echo=FALSE}
cd $HOME/projects/bsm/results/2018-09-12-sequenced-individuals/
synapse login
synapse get syn2279441
```

```{r}
clinical <- read.csv("~/projects/bsm/results/2018-09-12-sequenced-individuals/CMC_Human_clinical_metadata.csv")
rownames(clinical) <- sub("CMC_", "", clinical$Individual.ID) # remove CMC_ prefix
```

## Extension: sequenced samples

For any given individual three types of sample are possible: *muscle*, *NeuN+* and *NeuN-*.  But not all sample types have been sequenced for every individual.  The table below---generated by `sequenced-samples.sh`---presents the details.

```{r engine="bash"}
samples=$HOME/projects/bsm/results/2018-09-12-sequenced-individuals/sequenced-samples
cat $samples
```

The printed inventory on the hard disks received from the sequencing company is accessible [here](https://photos.app.goo.gl/ttjSFEHPcSV1Wrvt5).  It shows that the samples that are missing from server `ada` are also missing from the printed inventory, therefore these samples are missing because haven't been sequenced yet.  Note that the contents of one of the hard drives has been verified to match the printed inventory.

Inspecting `BSM_Project_Chess_v2.csv` shows that the lack of FASTQ files can have two reasons

1. existing library not sequenced; see MSSM_295 and MSSM_304
1. nonexisting library; see PITT_064, PITT_118

## Summary: from FASTQs to VCFs

This section presents results generated semi-autimatically.  Key files include

* `tables/summary-rownames.csv` is a boiler plate containing row names (pertaining to the workflow) for the following tables:
* `tables/summary-common-sample.tsv` and `tables/summary-benchmark.tsv` have been manually filled out
* `src/summary-cmc.sh` (run on `ada`) automatically generates `results/2018-09-12-sequenced-individuals/summary-cmc.tsv`

Note that the location of `summary-cmc.tsv` is not the `tables/` directory but under `results/`, reflecting the fact that it has been generated not manually but by running a script (therefore should not be version controlled).

The table below summarizes progress in the analytic workflow across experiments on various individuals (i.e. real or modeled subjects/individuals).

Object types of workflow:

1. FASTQs
1. BAMs
1. VCFs---note that the table presents only the VCFs filtered for SNVs

Type of individuals

1. CommonMind
1. common sample (BSMN)
1. benchmark (modeled individual)---note that for this individual type the tissue sample types (NeuN+, NeuN-, muscle) are not applicable

```{r}
fl <- c(cmc = "~/projects/bsm/results/2018-09-12-sequenced-individuals/summary-cmc.tsv",
        common.sample = "~/projects/bsm/tables/summary-common-sample.tsv",
        benchmark = "~/projects/bsm/tables/summary-benchmark.tsv")
summ <- lapply(fl, read.delim, row.names = 1)
summ
summ.all <- do.call(cbind, summ)
```

```{r}
Dx <- c("Control", "SCZ")
names(Dx) <- Dx
cmc <- lapply(Dx, function(d) summ$cmc[ names(summ$cmc) %in% rownames(clinical[clinical$Dx == d, ]) ])
cmc.long <- lapply(cmc, reshape.summ)
cmc.all.long <- do.call(rbind, lapply(names(cmc.long), function(y) cbind(cmc.long[[y]], data.frame(Dx = y))))
```

The same information graphically

```{r summary}
summ.all.long <- reshape.summ(summ.all)
my.col <- c("white", "gray")
levelplot(done ~ individuals * workflow, data = summ.all.long, col.regions = my.col, colorkey = FALSE, scales = list(x = list(rot = 90)), xlab = "", ylab = "")
levelplot(done ~ individuals * workflow, data = cmc.all.long, col.regions = my.col, colorkey = FALSE, scales = list(x = list(rot = 90)), xlab = "", ylab = "")
```

Write results to file

```{r}
write.csv(summ.all, "~/projects/bsm/results/2018-09-12-sequenced-individuals/summary-all.csv")
```
