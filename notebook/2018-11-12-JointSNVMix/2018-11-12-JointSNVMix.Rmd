---
layout: default
title: JointSNVMix2
tags: [ JointSNVMix2 ]
#featimg: "all-1.png"
---

Testing JointSNVMix2 and inspecting its output: the posterior probability of various genotypes for the case or control sample and of various types of somatic mutation.

## Preparation

The `bash` code below shows how the `jsm.tsv` files have been generated.  See details in each `runme` file.

```{r engine="bash", eval=FALSE}
# run JointSNVMix2 
cd $HOME/projects/bsm/results/2018-11-12-JointSNVMix
for wd in chr22 1Mb 10Mb 100Mb; do
    $wd/runme & # asynchronous evaluation (each process runs on thread)
done
# ...wait for all processes to complete...
# downsample rows (genome positions): keep every 1000th
$HOME/projects/bsm/notebook/2018-11-12-JointSNVMix/sample-every chr22/jsm.tsv 1000
```

The output of JointSNVMix2 is a tab delimited file in which rows are records (for each base position) and columns are various annotations.

```{r engine="bash", eval=TRUE}
cd $HOME/projects/bsm/results/2018-11-12-JointSNVMix
head -n2 chr22/jsm.tsv.every-1000
```

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(lattice)
library(latticeExtra)
opts_chunk$set(dpi = 144)
opts_chunk$set(out.width = "600px")
opts_chunk$set(fig.asp = 2/3)
opts_chunk$set(dev = c("png", "pdf"))
lattice.options(default.args = list(as.table = TRUE))
lattice.options(default.theme = "standard.theme")
```

The script contains the importer for `jsm.tsv` files.

```{r}
source("2018-11-12-JointSNVMix.R")
```

Import and process data.

```{r}
tsv <- c(benchmark = "~/projects/bsm/results/2018-11-12-JointSNVMix/chr22/jsm.tsv.every-1000")
records <- lapply(tsv, get.records, TRUE)
# high level graphic function
GThist <- function(sset, dt = records$benchmark, lay = c(length(sset), 1), ...) {
    histogram(~ p | GT, data = records$benchmark, subset = GT %in% sset,
              layout = lay, xlab = "Posterior Probability", ...)
}
```

## Results: benchmark

### Genotype probabilities for control sample (Mix3)

The upper and lower graphs show the same distributions but on different scaling of the $$y$$ axis (percentage: relative frequency).  The three panels have the following meaning:

|--------------------|--------------------|--------------------|
| symbol             |control sample GT   |case sample genotype|
|--------------------|--------------------|--------------------|
| AA_XY              | AA (Ref/Ref)       | any genotype       |
| AB_XY              | AB (Ref/Alt)       | any genotype       |
| BB_XY              | BB (Alt/Alt)       | any genotype       |
|--------------------|--------------------|--------------------|

```{r benchmark-controlGT}
GThist(c("AA_XY", "AB_XY", "BB_XY"), main = "Control sample genotypes")
GThist(c("AA_XY", "AB_XY", "BB_XY"), main = "Control sample genotypes", ylim = c(0, 1.5))
```

Clearly, most but few positions are likely to have AA (Ref/Ref) genotype.

### Genotype probabilities for case sample (Mix1)

|--------------------|--------------------|--------------------|
| symbol             |control sample GT   |case sample genotype|
|--------------------|--------------------|--------------------|
| XY_AA              | any genotype       | AA (Ref/Ref)       |
| XY_AB              | any genotype       | AB (Ref/Alt)       |
| XY_BB              | any genotype       | BB (Alt/Alt)       |
|--------------------|--------------------|--------------------|

```{r benchmark-caseGT, echo=TRUE}
GThist(c("XY_AA", "XY_AB", "XY_BB"), main = "Case sample genotypes")
GThist(c("XY_AA", "XY_AB", "XY_BB"), main = "Case sample genotypes", ylim = c(0, 1.5))
```

## Probability of somatic mutation from AA genotype

|--------------------|--------------------|--------------------|
| symbol             |control sample GT   |case sample genotype|
|--------------------|--------------------|--------------------|
| AA_AB              | AA (Ref/Ref)       | AB (Ref/Alt)       |
| AA_BB              | AA (Ref/Ref)       | BB (Alt/Alt)       |
| AA_XB              | AA (Ref/Ref)       | AB or BB           |
|--------------------|--------------------|--------------------|

```{r benchmark-som-mut-AA, echo=TRUE}
GThist(c("AA_AB", "AA_BB", "AA_XB"), main = "Somatic mutations from AA genotype")
GThist(c("AA_AB", "AA_BB", "AA_XB"), main = "Somatic mutations from AA genotype", ylim = c(0, 1.5))
```

## Probability of somatic mutation from AB genotype

|--------------------|--------------------|--------------------|
| symbol             |control sample GT   |case sample genotype|
|--------------------|--------------------|--------------------|
| AB_AA              | AB (Ref/Alt)       | AA (Ref/Ref)       |
| AB_BB              | AB (Ref/Alt)       | BB (Alt/Alt)       |
| AB_XX              | AB (Ref/Alt)       | AA or BB           |
|--------------------|--------------------|--------------------|

```{r benchmark-som-mut-AB, echo=TRUE}
GThist(c("AB_AA", "AB_BB", "AB_XX"), main = "Somatic mutations from AB genotype")
GThist(c("AB_AA", "AB_BB", "AB_XX"), main = "Somatic mutations from AB genotype", ylim = c(0, 1.5))
```

## Probability of somatic mutation from BB genotype

|--------------------|--------------------|--------------------|
| symbol             |control sample GT   |case sample genotype|
|--------------------|--------------------|--------------------|
| BB_AA              | BB (Alt/Alt)       | AA (Ref/Ref)       |
| BB_AB              | BB (Alt/Alt)       | AB (Ref/Alt)       |
| BB_AX              | BB (Alt/Alt)       | AA or AB           |
|--------------------|--------------------|--------------------|

```{r benchmark-som-mut-BB, echo=TRUE}
GThist(c("BB_AB", "BB_AA", "BB_AX"), main = "Somatic mutations from BB genotype")
GThist(c("BB_AB", "BB_AA", "BB_AX"), main = "Somatic mutations from BB genotype", ylim = c(0, 1.5))
```

### Common sample
